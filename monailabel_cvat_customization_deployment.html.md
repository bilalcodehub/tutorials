# Customizing and Deploying MONAILabel Models with Nuclio and CVAT for
AI-Assisted Tool Tracking


<!-- WARNING: THIS FILE WAS AUTOGENERATED! DO NOT EDIT! -->

### Step 1: Accessing the MONAILabel Docker Container

We need to modify the `tooltracking.yaml` file inside the MONAILabel
Docker container to customize the labels for the AI tool tracking model.

1.  **Run MONAILabel Docker Container**: Open a terminal and run the
    following command to access the MONAILabel container:

    ``` bash
    docker run -it --rm --gpus all --ipc=host --net=host \
        -p 8080:8080 \
        -v /home/exsdatalab/data/endo:/opt/monai/datasets \
        -v /home/exsdatalab/data/apps:/opt/monai/apps \
        projectmonai/monailabel:latest bash
    ```

    This command will launch the MONAILabel container and provide you
    with an interactive terminal.

### Step 2: Editing the `tooltracking.yaml` File

The `tooltracking.yaml` file defines the labels used by MONAILabel’s AI
tool tracking model. If the default model is not sufficient (for
example, if you want to track custom labels rather than the default
“Tool” label), you can customize it to suit your needs.

1.  **Open the YAML file for Editing**: Inside the Docker container, use
    `nano` or `vi` to open the `tooltracking.yaml` file:

    ``` bash
    nano /usr/local/monailabel/plugins/cvat/endocopy/tooltracking.yaml
    ```

2.  **Modify the Labels**: Replace the default labels:

    ``` yaml
    spec: |
          [
            { "id": 1, "name": "Tool" }
          ]
    ```

    With your custom labels, for example:

    ``` yaml
    spec: |
          [
            { "id": 1, "name": "Tumor_Cancer" },
            { "id": 2, "name": "Tumor_Sessile_Adenoma" },
            { "id": 3, "name": "Tumor_Polypoidal_Adenoma" },
            { "id": 4, "name": "Tumor_Pedunculated_Adenoma" },
            ...
            { "id": 29, "name": "Reflection" }
          ]
    ```

3.  **Save the File**: After modifying the file, save it and exit the
    editor.

### Step 3: Copying the Customized File for Persistence

To ensure the changes are persistent, we will copy the customized
`tooltracking.yaml` file out of the Docker container.

1.  **Copy the File for Persistence**: Run the following command to copy
    the updated `tooltracking.yaml` file to your local system:

    ``` bash
    docker cp $(docker container ls | grep 'sweet_agnesi' | awk '{print $1}'):/usr/local/monailabel/plugins/cvat apps/endocopy/cvat_plugins
    ```

### Step 4: Deploying the Models with Nuclio

Now that the labels have been customized, we will deploy the updated
models using Nuclio.

1.  **Create a Workspace Folder**: Inside the `cvat` folder, create a
    `workspace` folder:

    ``` bash
    mkdir workspace
    ```

2.  **Copy the CVAT Plugin from MONAILabel**: Use the following command
    to copy the CVAT plugin folder from the MONAILabel container into
    the `workspace` folder:

    ``` bash
    docker cp $(docker container ls | grep 'sweet_agnesi' | awk '{print $1}'):/usr/local/monailabel/plugins/cvat workspace
    ```

3.  **Deploy the Models with Nuclio**: Deploy the updated models by
    running the following command:

    ``` bash
    ./workspace/cvat/deploy.sh endoscopy
    ```

    If you only want to deploy a specific function (such as
    `tooltracking`), run:

    ``` bash
    ./workspace/cvat/deploy.sh endoscopy tooltracking
    ```

### Step 5: Verifying the Deployment

1.  **Open Nuclio Dashboard**: After deploying the models, open the
    Nuclio dashboard in your browser to verify that the models have been
    deployed successfully:

        http://localhost:8070

2.  **Verify CVAT Integration**: Open CVAT by navigating to:

        http://localhost:8080

    Log in with your credentials, and you should now see a **Models**
    tab. Click on it to view the deployed models and verify that they
    are available for use.

### Next Steps

You have successfully customized MONAILabel’s AI tool tracking model and
deployed it using Nuclio. You can now use CVAT to perform automated
annotations based on your custom labels.
